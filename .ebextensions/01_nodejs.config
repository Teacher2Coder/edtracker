option_settings:
  aws:elasticbeanstalk:application:environment:
    NODE_ENV: production
    NPM_USE_PRODUCTION: false
    SKIP_SEEDING: true
  aws:elasticbeanstalk:command:
    Timeout: 2400
  aws:autoscaling:launchconfiguration:
    InstanceType: t3.micro
    SecurityGroups: default

container_commands:
  01_install_root_deps:
    command: "npm install --production"
    cwd: "/var/app/ondeck"
  02_install_server_deps:
    command: "npm install --production"
    cwd: "/var/app/ondeck/server"
  03_install_client_deps:
    command: "npm install"
    cwd: "/var/app/ondeck/client"
  04_build_client:
    command: "npm run build"
    cwd: "/var/app/ondeck/client"
  05_verify_server_deps:
    command: "ls -la node_modules/express || echo 'Express not found in server node_modules'"
    cwd: "/var/app/ondeck/server"
    ignoreErrors: true
  06_verify_client_build:
    command: "ls -la dist/ || echo 'Client build directory not found'"
    cwd: "/var/app/ondeck/client"
    ignoreErrors: true
  07_cleanup:
    command: "rm -rf node_modules"
    cwd: "/var/app/ondeck/client"
    ignoreErrors: true 